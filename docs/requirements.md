# MemoLia 要件定義書

## 目次

1. [プロジェクト概要](#1-プロジェクト概要)
   - 1.1 [プロジェクト名](#11-プロジェクト名)
   - 1.2 [プロジェクトの目的](#12-プロジェクトの目的)
   - 1.3 [対象ユーザー](#13-対象ユーザー)
   - 1.4 [技術スタック](#14-技術スタック)
2. [機能要件](#2-機能要件)
   - 2.1 [認証機能](#21-認証機能)
   - 2.2 [URL管理機能](#22-url管理機能)
   - 2.3 [分類システム](#23-分類システム)
   - 2.4 [検索機能](#24-検索機能)
   - 2.5 [ダッシュボード機能](#25-ダッシュボード機能)
   - 2.6 [ブックマークレット機能](#26-ブックマークレット機能)
   - 2.7 [PWA機能](#27-pwa機能)
   - 2.8 [国際化機能](#28-国際化機能)
3. [非機能要件](#3-非機能要件)
   - 3.1 [パフォーマンス要件](#31-パフォーマンス要件)
   - 3.2 [セキュリティ要件](#32-セキュリティ要件)
   - 3.3 [可用性要件](#33-可用性要件)
   - 3.4 [保守性要件](#34-保守性要件)
   - 3.5 [拡張性要件](#35-拡張性要件)
4. [データベース設計](#4-データベース設計)
   - 4.1 [テーブル構成](#41-テーブル構成)
   - 4.2 [インデックス設計](#42-インデックス設計)
   - 4.3 [ビュー設計](#43-ビュー設計)
5. [UI/UX要件](#5-uiux要件)
   - 5.1 [レスポンシブデザイン](#51-レスポンシブデザイン)
   - 5.2 [アクセシビリティ](#52-アクセシビリティ)
   - 5.3 [ユーザビリティ](#53-ユーザビリティ)
   - 5.4 [デザインシステム](#54-デザインシステム)
6. [運用要件](#6-運用要件)
   - 6.1 [デプロイメント](#61-デプロイメント)
   - 6.2 [監視・ログ](#62-監視ログ)
   - 6.3 [バックアップ](#63-バックアップ)
7. [制約事項](#7-制約事項)
   - 7.1 [技術的制約](#71-技術的制約)
   - 7.2 [ビジネス制約](#72-ビジネス制約)
   - 7.3 [法的制約](#73-法的制約)
8. [将来の拡張機能](#8-将来の拡張機能)
   - 8.1 [検討中の機能](#81-検討中の機能)
   - 8.2 [スケールアウト対応](#82-スケールアウト対応)
9. [用語定義](#9-用語定義)
10. [参考資料](#10-参考資料)
11. [変更履歴](#11-変更履歴)

## 1. プロジェクト概要

### 1.1 プロジェクト名

MemoLia

### 1.2 プロジェクトの目的

ユーザーがお気に入りのURLを効率的に整理・保管・管理するためのWebアプリケーションを提供する。カテゴリ、ジャンル、タグによる柔軟な分類システムを実装し、高速な検索機能と直感的なユーザーインターフェースを提供する。

### 1.3 対象ユーザー

- インターネット上で多数のURLをブックマークする必要があるユーザー
- URLを体系的に整理・分類したいユーザー
- 複数のデバイスからアクセスしてURLを管理したいユーザー
- パスワードレス認証を希望するユーザー

### 1.4 技術スタック

- フロントエンド: Next.js 15.2.8, React 19, TypeScript
- バックエンド: Next.js API Routes
- データベース: PostgreSQL (Neon Serverless)
- 認証: NextAuth.js v5 (OAuth)
- スタイリング: Tailwind CSS
- 状態管理: Zustand, React Query
- 国際化: next-intl
- デプロイ: Vercel

## 2. 機能要件

### 2.1 認証機能

#### 2.1.1 OAuth認証

- Googleアカウントによる認証
- GitHubアカウントによる認証
- Discordアカウントによる認証
- パスワード不要の認証方式
- 複数プロバイダーの紐付け対応

#### 2.1.2 セッション管理

- 自動ログイン機能
- セッション有効期限管理
- トークンリフレッシュ機能

#### 2.1.3 認証ガード

- 認証が必要なページへのアクセス制御
- 未認証ユーザーのリダイレクト処理

### 2.2 URL管理機能

#### 2.2.1 URL登録

- URLの手動登録
- タイトルの自動取得または手動入力
- 説明文の入力（最大1000文字）
- ファビコンURLの自動取得または手動設定
- サムネイル画像URLの設定
- 同一URLの重複登録防止（ユーザー単位）

#### 2.2.2 URL編集

- タイトルの編集
- URLの編集
- 説明文の編集
- ファビコンURLの編集
- サムネイル画像URLの編集

#### 2.2.3 URL削除

- URLの削除機能
- 関連するカテゴリ・ジャンル・タグとの関連も削除

#### 2.2.4 URL表示

- ジャンル別のURL一覧表示
- ページネーション対応
- 仮想スクロールによる大量データの効率的な表示
- 最終アクセス日時の表示
- 閲覧回数の表示

#### 2.2.5 URL共有

- 公開設定によるURLの共有
- 共有URLの閲覧回数カウント
- 共有URLの詳細ページ表示

### 2.3 分類システム

#### 2.3.1 カテゴリ機能

- カテゴリの作成
- カテゴリの階層化（最大10階層）
- カテゴリの編集
- カテゴリの削除
- カテゴリの並び替え
- カテゴリの色設定
- カテゴリのアイコン設定
- フォルダ機能（カテゴリをフォルダとして使用）
- カテゴリ名の最大100文字
- カテゴリ説明の最大500文字

#### 2.3.2 ジャンル機能

- ジャンルの作成（カテゴリに紐付け）
- ジャンルの編集
- ジャンルの削除
- ジャンルの並び替え
- ジャンルの色設定
- ジャンルのアイコン設定
- ジャンル名の最大100文字
- ジャンル説明の最大500文字

#### 2.3.3 タグ機能

- タグの作成
- タグの編集
- タグの削除
- タグの色設定
- URLへのタグ付け（複数タグ対応）
- タグ名の最大100文字

### 2.4 検索機能

#### 2.4.1 全文検索

- URLタイトルによる検索
- URL説明文による検索
- 多言語対応検索（日本語・英語）
- 自動言語判定による検索最適化

#### 2.4.2 分類による検索

- カテゴリによる絞り込み
- ジャンルによる絞り込み
- タグによる絞り込み
- 複数条件の組み合わせ検索

### 2.5 ダッシュボード機能

#### 2.5.1 統計情報表示

- 登録URL総数
- カテゴリ数
- ジャンル数
- タグ数
- 最近追加されたURL
- よくアクセスするURL

#### 2.5.2 ナビゲーション

- カテゴリ一覧の表示
- カテゴリ階層の表示
- ジャンル一覧の表示
- クイックアクセス機能

### 2.6 ブックマークレット機能

#### 2.6.1 ブックマークレットインストール

- ブックマークレットのインストール手順表示
- ブラウザ別のインストール方法説明
- Safariのプライベートモード非対応の警告

#### 2.6.2 URL登録

- 現在閲覧中のページのURLを自動取得
- タイトルの自動取得
- 説明文の自動取得
- ワンクリックでのURL登録

### 2.7 PWA機能

#### 2.7.1 プログレッシブウェブアプリ

- ホーム画面への追加
- オフライン対応の準備
- アプリライクな体験の提供

#### 2.7.2 マニフェスト設定

- アプリ名の設定
- アイコンの設定
- テーマカラーの設定
- 表示モードの設定

### 2.8 国際化機能

#### 2.8.1 多言語対応

- 日本語対応
- 英語対応
- ロケール別のルーティング
- 言語切り替え機能

#### 2.8.2 ローカライゼーション

- UIテキストの多言語化
- 日付・時刻のローカライズ
- 数値フォーマットのローカライズ

### 2.9 広告機能

#### 2.9.1 Google AdSense

- Google AdSense広告の表示
- レスポンシブ広告フォーマット対応
- デスクトップ・モバイル別の広告配置
- CSP（Content Security Policy）対応

### 2.10 パフォーマンス監視機能

#### 2.10.1 Vercel Speed Insights

- Vercel Speed Insightsによるパフォーマンス監視
- Web Vitalsの計測
- Real Experience Score（RES）の計測
- パフォーマンスメトリクスの可視化

## 3. 非機能要件

### 3.1 パフォーマンス要件

#### 3.1.1 レスポンス時間

- ページ読み込み時間: 3秒以内
- APIレスポンス時間: 1秒以内
- 検索レスポンス時間: 2秒以内

#### 3.1.2 スループット

- 同時接続数: 1000ユーザー以上
- 1秒あたりのリクエスト数: 100リクエスト以上

#### 3.1.3 最適化

- コード分割による初期読み込み時間の短縮
- 仮想スクロールによる大量データの効率的な表示
- 画像の最適化
- キャッシュ戦略の実装
- サーバーサイドレンダリング（SSR）による初期読み込み最適化
- データベースキャッシュ（60秒間）によるレスポンス時間の短縮

### 3.2 セキュリティ要件

#### 3.2.1 認証・認可

- OAuth 2.0による安全な認証
- セッション管理の適切な実装
- CSRF対策
- XSS対策

#### 3.2.2 データ保護

- ユーザーデータの暗号化
- SQLインジェクション対策
- 入力値のバリデーション
- レート制限の実装

#### 3.2.3 プライバシー

- ユーザーデータの適切な管理
- プライバシーポリシーの提供
- 利用規約の提供

### 3.3 可用性要件

#### 3.3.1 稼働率

- 目標稼働率: 99.9%以上
- ダウンタイムの最小化

#### 3.3.2 エラーハンドリング

- 適切なエラーメッセージの表示
- エラーログの記録
- エラー通知機能

### 3.4 保守性要件

#### 3.4.1 コード品質

- TypeScriptによる型安全性
- ESLintによるコード品質チェック
- Prettierによるコードフォーマット
- 単体テストの実装（推奨）

#### 3.4.2 ドキュメント

- コードコメントの記述
- API仕様書の作成
- データベース設計書の作成

### 3.5 拡張性要件

#### 3.5.1 スケーラビリティ

- サーバーレスアーキテクチャによる自動スケーリング
- データベースのスケールアウト対応
- CDNによるコンテンツ配信

#### 3.5.2 機能拡張

- モジュール化された設計
- プラグイン機構の検討
- APIの拡張性を考慮した設計

## 4. データベース設計

### 4.1 テーブル構成

#### 4.1.1 ユーザー関連テーブル

- users: ユーザー基本情報
- user_providers: OAuthプロバイダー情報

#### 4.1.2 URL関連テーブル

- urls: URL基本情報
- url_categories: URLとカテゴリ・ジャンルの関連
- url_tags: URLとタグの関連

#### 4.1.3 分類関連テーブル

- categories: カテゴリマスタ（階層化対応）
- genres: ジャンルマスタ
- tags: タグマスタ

### 4.2 インデックス設計

- ユーザー別検索用インデックス
- 多言語全文検索用GINインデックス
- ソート用複合インデックス
- 部分インデックス（アクティブなレコードのみ）

### 4.3 ビュー設計

- url_details: URL詳細情報ビュー
- user_stats: ユーザー統計情報ビュー
- popular_urls: 人気URLビュー
- category_hierarchy: カテゴリ階層ビュー
- genre_with_category: ジャンル・カテゴリ統合ビュー
- multilingual_search_results: 多言語検索結果ビュー

## 5. UI/UX要件

### 5.1 レスポンシブデザイン

- デスクトップ対応（1024px以上）
- タブレット対応（768px以上）
- モバイル対応（320px以上）
- デバイス別の最適化されたレイアウト

### 5.2 アクセシビリティ

- WCAG 2.1 Level AA準拠
- キーボード操作対応
- スクリーンリーダー対応
- 適切なコントラスト比の確保

### 5.3 ユーザビリティ

- 直感的なナビゲーション
- 明確なフィードバック
- エラーメッセージの分かりやすさ
- ローディング状態の表示

### 5.4 デザインシステム

- 一貫したデザイン言語
- 再利用可能なコンポーネント
- テーマカラーの統一
- タイポグラフィの統一

## 6. 運用要件

### 6.1 デプロイメント

- Vercelへの自動デプロイ
- 環境変数の適切な管理
- ビルドプロセスの最適化

### 6.2 監視・ログ

- エラーログの記録
- パフォーマンス監視
- ユーザー行動の追跡（プライバシーに配慮）

### 6.3 バックアップ

- データベースの定期バックアップ
- ポイントインタイムリカバリ対応

## 7. 制約事項

### 7.1 技術的制約

- Node.js 20.0.0以上必須
- PostgreSQL 13以上推奨
- モダンブラウザ対応（Chrome, Firefox, Safari, Edgeの最新2バージョン）

### 7.2 ビジネス制約

- 無料プランの提供
- 個人利用を想定した設計

### 7.3 法的制約

- 利用規約の遵守
- プライバシーポリシーの遵守
- GDPR対応（将来的に）

## 8. 将来の拡張機能

### 8.1 検討中の機能

- コメント機能
- お気に入り機能
- 共有機能の拡張
- カテゴリの移動・並び替え機能
- バルク操作機能
- 多言語UI対応の拡張
- 翻訳機能
- 言語別の統計ダッシュボード

### 8.2 スケールアウト対応

- 読み取りレプリカの導入
- パーティショニングの検討
- シャーディングの検討

## 9. 用語定義

### 9.1 カテゴリ

URLを分類するための大分類。階層化が可能で、フォルダとしても機能する。

### 9.2 ジャンル

カテゴリ内の中分類。カテゴリに紐付けられ、URLはジャンルに分類される。

### 9.3 タグ

URLに付与できる自由な分類。カテゴリやジャンルとは独立して使用できる。

### 9.4 ブックマークレット

ブラウザのブックマークバーに追加することで、現在閲覧中のページのURLを簡単に登録できるJavaScriptコード。

### 9.5 PWA

Progressive Web
Appの略。Webアプリケーションをネイティブアプリのように使用できる技術。

## 10. 参考資料

### 10.1 技術ドキュメント

- Next.js公式ドキュメント
- React公式ドキュメント
- PostgreSQL公式ドキュメント
- NextAuth.js公式ドキュメント

### 10.2 設計ドキュメント

- ER図（sql/development/ER_DIAGRAM.md）
- データベース設計（sql/development/）

## 11. 変更履歴

| 日付       | バージョン | 変更内容                                                                                       | 変更者 |
| ---------- | ---------- | ---------------------------------------------------------------------------------------------- | ------ |
| 2025-12-01 | 1.0        | 初版作成                                                                                       | -      |
| 2025-01-04 | 1.1        | AdSense機能とSpeed Insights機能の追加、CSP設定の更新、Service WorkerのPOSTリクエスト処理の追加 | -      |
